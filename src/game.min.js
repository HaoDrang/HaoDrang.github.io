/*! HaoDrang.github.io-0.0.1.js 2016-04-26 */
this.state=this.state||{},function(){"use strict";function a(a){this.service=a.service,this.context=a}a.key="null",a.prototype.enterState=function(a){return gameutils.isFun(a)||"undefined"==typeof a?!0:(console.log("param type should be function or undefined"),!1)},a.prototype.exitState=function(a){return gameutils.isFun(a)||"undefined"==typeof a?!0:(console.log("param type should be function or undefined"),!1)},a.prototype.handle=function(a){},state.StateBase=a}();var common=common||{};!function(){function a(a,b){var c,d,e;return c=a,d=new common.Property(b.getResult("gameinfo")),e=b,{stage:c,prop:d,loader:e}}common.Service=a}(),this.gevt=this.gevt||{},function(){gevt.REQ_LOGIN="rq.lg",gevt.ENTER_GAME="ent.g",gevt.BACK_TO_MENU="bk.2.mn"}(),function(){function a(a){var b=a;return console.log("property initialize"),console.log(a),{gameinfo:b}}common.Property=a}(),this.ui=this.ui||{},function(){"use strict";function a(a,b){this.Container_constructor(),this.sprite=void 0,this.spritesheet=a,this.st={NORMAL:b[0],HOVER:b[1],CLICK:b[2],DISABLED:b[3]},this.buildUI(),this.on("click",this.handleClickEvent,this,!1,void 0,!0),this.on("mouseover",this.handleHoverEvent,this,!1,void 0,!0),this.on("mousedown",this.handlePressedEvent,this,!1,void 0,!0),this.on("mouseout",this.handleMouseLeaveEvent,this,!1,void 0,!0)}var b=createjs.extend(a,createjs.Container);b.STATE={NORMAL:0,HOVER:1,CLICK:2,DISABLED:3},b.handleClickEvent=function(a){console.log("handleClickEvent"),this.sprite.gotoAndStop(this.st.CLICK)},b.handleHoverEvent=function(a){this.sprite.gotoAndStop(this.st.HOVER),console.log("handleHoverEvent"+a.currentTarget)},b.handleMouseLeaveEvent=function(a){console.log("handleMouseLeaveEvent"),this.sprite.gotoAndStop(this.st.NORMAL)},b.handlePressedEvent=function(a){console.log("handleMouseLeaveEvent"),this.sprite.gotoAndStop(this.st.CLICK)},b.buildUI=function(){this.sprite=new createjs.Sprite(this.spritesheet,this.st.NORMAL),this.sprite.stop(),this.addChild(this.sprite)},createjs.promote(a,"Container"),ui.Button=a}(),this.ui=this.ui||{},function(){function a(a){this.Container_constructor(),this.serv=a}createjs.extend(a,createjs.Container);createjs.promote(a,"Container"),ui.Panel=a}(),this.Game=this.Game||{},function(){"use strict";function a(a,c){b=this,this.stage=a,this.service=c,this.loader=c.loader,this.context=new state.StateOwner,this.context.initialize(this.service),console.log("state owner created")}var b;a.prototype.Start=function(){this.stage.enableMouseOver(50),b.context.StateStart(),createjs.Ticker.addEventListener("tick",b.handleTick),console.log("game core start...")},a.prototype.handleTick=function(a){a.paused||b.stage.update()},Game=a}(),this.ui=this.ui||{},function(){"use strict";function a(a){this.serv=a,this.initialize()}var b=createjs.extend(a,createjs.Container);b.initialize=function(){this.Container_initialize(),this.buildUI(this.serv)},b.buildUI=function(a){var b=new createjs.Bitmap(a.loader.getResult("loginbg"));this.addChild(b),gameutils.fitV(b,CANVAS_H),gameutils.anchorInCanvas(gameutils.ALIGN.MIDDLE,gameutils.ALIGN.UP,b);var c=a.prop.gameinfo.ui_info,d={images:[a.loader.getResult("game_ui")],frames:c.ui_spritesheet.frames},e=c.ui_spritesheet.ui_id,f=new createjs.SpriteSheet(d),g=new ui.Button(f,[e.btn_newgame_normal,e.btn_newgame_normal,e.btn_newgame_clicked,e.btn_newgame_clicked]);this.addChild(g),gameutils.anchorInCanvas(gameutils.ALIGN.RIGHT,gameutils.ALIGN.TOP,g),g.on("click",this.onFullScreenClick,this);var h=new ui.Button(f,[e.btn_newgame_normal,e.btn_newgame_normal,e.btn_newgame_clicked,e.btn_newgame_clicked]);this.addChild(h),gameutils.anchorInCanvas(gameutils.ALIGN.MIDDLE,gameutils.ALIGN.MIDDLE,h),h.on("click",this.onLoginBtnClick,this)},b.onFullScreenClick=function(a){console.log("this is a important message"),toggleFullScreen(this.serv.stage.canvas)},b.onLoginBtnClick=function(a){this.dispatchEvent(gevt.REQ_LOGIN)},createjs.promote(a,"Container"),ui.LoginPanel=a}(),this.ui=this.ui||{},function(){function a(a){this.Panel_constructor(a),this.buildUI(a)}var b=createjs.extend(a,ui.Panel);b.buildUI=function(a){this.btnWrapper=new createjs.Container,this.btnWrapper.width=400,this.btnWrapper.height=600,this.addChild(this.btnWrapper),gameutils.anchorInCanvas(gameutils.ALIGN.MIDDLE,gameutils.ALIGN.DOWN,this.btnWrapper);var b=(new createjs.Graphics).beginFill("#808080").drawRect(0,0,400,600),c=new createjs.Shape(b);this.btnWrapper.addChild(c);var d=a.prop.gameinfo.ui_info,e={images:[a.loader.getResult("game_ui")],frames:d.ui_spritesheet.frames},f=d.ui_spritesheet.ui_id,g=new createjs.SpriteSheet(e);this.playbtn=new ui.Button(g,[f.btn_newgame_normal,f.btn_newgame_clicked,f.btn_newgame_clicked,f.btn_newgame_clicked]),this.btnWrapper.addChild(this.playbtn),this.settingbtn=new ui.Button(g,[f.btn_options_normal,f.btn_options_normal,f.btn_options_normal,f.btn_options_normal]),this.btnWrapper.addChild(this.settingbtn),this.exitbtn=new ui.Button(g,[f.btn_exit_normal,f.btn_exit_normal,f.btn_exit_normal,f.btn_exit_normal]),this.btnWrapper.addChild(this.exitbtn),gameutils.simpleAlign([this.playbtn,this.settingbtn,this.exitbtn],10),this.playbtn.on("click",this.onPlayBtnClicked,this)},b.onPlayBtnClicked=function(a){this.dispatchEvent(gevt.ENTER_GAME)},createjs.promote(a,"Panel"),ui.MenuPanel=a}(),this.ui=this.ui||{},function(){function a(a){this.Panel_constructor(a),this.levelIconWrapper=void 0,this.levelIcons=[],this.backBtn=void 0,this.buildUI(a)}var b=createjs.extend(a,ui.Panel);b.buildUI=function(a){for(var b=a.prop.gameinfo.ui_info,c={images:[a.loader.getResult("game_ui")],frames:b.ui_spritesheet.frames},d=b.ui_spritesheet.ui_id,e=new createjs.SpriteSheet(c),f=0;3>f;f++)this.levelIcons[f]=new ui.Button(e,[f,f,f,f]),this.addChild(this.levelIcons[f]),this.levelIcons[f].on("click",this.onLevelClick,this,!1,f),console.log("create a button "+f);gameutils.simpleAlign(this.levelIcons,10,!0),this.backBtn=new ui.Button(e,[d.btn_exit_normal,d.btn_exit_normal,d.btn_exit_normal,d.btn_exit_normal]),this.addChild(this.backBtn),this.backBtn.on("click",this.onBackBtnClick,this)},b.onLevelClick=function(a,b){console.log(" level clicked :"+b)},b.onBackBtnClick=function(a){this.dispatchEvent(gevt.BACK_TO_MENU)},createjs.promote(a,"Panel"),ui.StagePanel=a}(),function(){function a(a){this.State_constructor(a)}a.key="ges",createjs.extend(a,state.StateBase),a.prototype.enterState=function(a){this.State_enterState(a)&&(console.log("game end state (rollup) enter..."),a&&a())},a.prototype.exitState=function(a){this.State_exitState(a)&&(console.log("game end state exit..."),a&&a())},a.prototype.handle=function(a){console.log("handle of gameend state... enter menu state next.");this.context.changeState(state.MenuState.key,function(){console.log("change state call back...(game state to munu State)"),console.log("and stop here...")})},createjs.promote(a,"State"),state.GameEndState=a}(),this.state=this.state||{},function(){"use strict";function a(a){this.State_constructor(a),this.panel=void 0}a.key="ls";var b=createjs.extend(a,state.StateBase);b.enterState=function(a){this.State_enterState(a)&&("undefined"==typeof this.panel?(this.panel=new ui.LoginPanel(this.service),this.service.stage.addChild(this.panel),this.panel.on(gevt.REQ_LOGIN,this.onRequestLogin,this)):this.panel.visible=!0,console.log("login sucessed.."),a&&a())},b.exitState=function(a){this.State_exitState(a)&&(this.panel.visible=!1,console.log("exit login state.."),a&&a())},b.handle=function(a){},b.onRequestLogin=function(a){console.log("player is requesting to login");var b=this;this.context.changeState(state.MenuState.key,function(){console.log("login handle callback done(called changeState to munustate)"),b.context.request("begin to handle menu state")})},createjs.promote(a,"State"),state.LoginState=a,state.DefaultState=a}(),this.state=this.state||{},function(){function a(a){this.State_constructor(a),this.panel=void 0}a.key="ms";var b=createjs.extend(a,state.StateBase);b.enterState=function(a){this.State_enterState(a)&&(this.panel=new ui.MenuPanel(this.service),this.service.stage.addChild(this.panel),this.panel.on(gevt.ENTER_GAME,this.onStartGameState,this),console.log("enter menustate..."),a&&a())},b.exitState=function(a){this.State_exitState(a)&&(this.panel.visible=!1,a&&a())},b.handle=function(a){},b.onStartGameState=function(a){this.context.changeState(state.PlayState.key,function(){})},createjs.promote(a,"State"),state.MenuState=a}(),this.state=this.state||{},function(){"use strict";function a(a){this.State_constructor(a),this.stagePanel=void 0,this.gamePanel=void 0,this.pausePanel=void 0,this.gamePlayLogic=void 0}a.key="ps";var b=createjs.extend(a,state.StateBase);b.enterState=function(a){this.State_enterState(a)&&(this.stagePanel=new ui.StagePanel(this.service),this.service.stage.addChild(this.stagePanel),this.stagePanel.on(gevt.BACK_TO_MENU,this.onBackToMenu,this),console.log("enter play state... begin to play"),a&&a())},b.exitState=function(a){this.State_exitState(a)&&(this.stagePanel&&(this.stagePanel.visible=!1),this.gamePanel&&(this.stagePanel.visible=!1),this.pausePanel&&(this.stagePanel.visible=!1),console.log("game end, exit game state..."),a&&a())},b.handle=function(a){},b.onBackToMenu=function(a){this.context.changeState(state.MenuState.key)},createjs.promote(a,"State"),state.PlayState=a}(),this.state=this.state||{},function(){"use strict";function a(){this.states={},this.curState=void 0}a.prototype.initialize=function(a){this.service=a,this.states[state.LoginState.key]=new state.LoginState(this),this.states[state.GameEndState.key]=new state.GameEndState(this),this.states[state.MenuState.key]=new state.MenuState(this),this.states[state.PlayState.key]=new state.PlayState(this)};var b=a.prototype;b.changeState=function(a,b){if(console.log("Target State : "+a),void 0===this.curState)this.curState=this.states[a],this.curState.State_enterState(b),this.curState.enterState(b);else{var c=this;this.curState.exitState(function(){c.curState=c.states[a],c.curState.enterState(b)})}},b.StateStart=function(){var a=this;this.changeState(state.DefaultState.key,function(b){console.log("default state ready: current default state:"+a.curState.name),a.request()})},b.request=function(a){this.curState.handle(a)},state.StateOwner=a}(),this.gameutils=this.gameutils||{},function(){"use strict";function a(a){return"function"==typeof a}function b(a,b,c){if(!(a instanceof createjs.DisplayObject))return void console.log("[WARNING] this is not an display object!");var d=a.getBounds();a.scaleX=b/d.width,a.scaleY=c/d.height}function c(a,b){if(!(a instanceof createjs.DisplayObject))return void console.log("[WARNING] this is not an display object!");var c=a.getBounds();a.scaleX=b/c.width,a.scaleY=a.scaleX}function d(a,b){if(!(a instanceof createjs.DisplayObject))return void console.log("[WARNING] this is not an display object!");var c=a.getBounds();a.scaleY=b/c.height,a.scaleX=a.scaleY}function e(a,b,c){k(a,b,c,CANVAS_W,CANVAS_H)}function f(a,b,c){var d=null;if(void 0!==c.parent){var e=c.parent;d=e.getBounds(),d=e.hasOwnProperty("width")&&e.hasOwnProperty("height")&&e.width>0&&e.height>0?{width:e.width,height:e.height}:e.getBounds()}null===d?(console.warn("[WRINING] cant get bounds of the target"),console.warn("1.target: "+c+" aligned based on canvas. Please use gameutils.anchorInCanvas instead."),k(a,b,c,CANVAS_W,CANVAS_H)):k(a,b,c,d.width,d.height)}function g(a,b,c){b=b||0;var d=0,e=0,f=j(a[0].parent);null===f||c===!0?(d=CANVAS_W,e=CANVAS_H):(d=f.width,e=f.height);var g=h(gameutils.DIRECTION.UP,a,b,d,e);i(gameutils.ALIGN.MIDDLE,gameutils.ALIGN.MIDDLE,gameutils.DIRECTION.UP,a,d,e,b,g)}function h(a,b,c,d,e){for(var f,g=0,h=0,i=0;i<b.length;i++)f=j(b[i]),g+=f.width,h+=f.height;g+=(b.length-1)*c,h+=(b.length-1)*c;var k=0;switch(a){case gameutils.DIRECTION.LEFT:case gameutils.DIRECTION.RIGHT:k=(d-g)/2;break;case gameutils.DIRECTION.UP:case gameutils.DIRECTION.DOWN:k=(e-h)/2}return k}function i(a,b,c,d,e,f,g,h){d.hasOwnProperty("length")||console.warn("[WARNING] the param you passed in is not an object array"),a=a||gameutils.ALIGN.MIDDLE,b=b||gameutils.ALIGN.MIDDLE,c=c||gameutils.DIRECTION.UP,e=e||0,f=f||0,g=g||0,h=h||0;for(var i,k,l=null,m=null,n=0;n<d.length;n++){if(i=d[n],l=j(i),void 0===k)switch(c){case gameutils.DIRECTION.LEFT:i.x=0+h;break;case gameutils.DIRECTION.RIGHT:i.x=e-l.width-h;break;case gameutils.DIRECTION.UP:i.y=0+h;break;case gameutils.DIRECTION.DOWN:i.y=f-l.height-h}else switch(c){case gameutils.DIRECTION.LEFT:i.x=k.x+m.width+g;break;case gameutils.DIRECTION.RIGHT:i.x=k.x-m.width-g;break;case gameutils.DIRECTION.UP:i.y=k.y+m.height+g;break;case gameutils.DIRECTION.DOWN:i.y=k.y-m.height-g}if(c===gameutils.DIRECTION.UP||c===gameutils.DIRECTION.DOWN)switch(a){case gameutils.ALIGN.LEFT:i.x=0+h;break;case gameutils.ALIGN.RIGHT:i.x=e-l.width-h;break;case gameutils.ALIGN.MIDDLE:i.x=(e-l.width)/2}if(c===gameutils.DIRECTION.LEFT||c===gameutils.DIRECTION.RIGHT)switch(b){case gameutils.ALIGN.UP:i.y=0+h;break;case gameutils.ALIGN.DOWN:i.y=f-l.height-h;break;case gameutils.ALIGN.MIDDLE:i.y=(f-l.height)/2}k=i,m=l}}function j(a){var b=null;if(a.hasOwnProperty("width")&&a.hasOwnProperty("height")&&a.width>0&&a.height>0)b={width:a.width,height:a.height};else{var c=a.getBounds();null!==c&&(b={width:c.width,height:c.height})}return b}function k(a,b,c,d,e){var f=c.getBounds(),g=c.x,h=c.y;switch(null===f&&c.hasOwnProperty("width")&&c.hasOwnProperty("height")&&(f={width:c.width,height:c.height}),a){case gameutils.ALIGN.LEFT:g=0;break;case gameutils.ALIGN.RIGHT:g=d-f.width*c.scaleX;break;case gameutils.ALIGN.MIDDLE:g=(d-f.width*c.scaleX)/2}switch(b){case gameutils.ALIGN.UP:h=0;break;case gameutils.ALIGN.DOWN:h=e-f.height*c.scaleY;break;case gameutils.ALIGN.MIDDLE:h=(e-f.height*c.scaleY)/2}c.x=g,c.y=h}gameutils.ALIGN={LEFT:"lf",RIGHT:"rt",UP:"up",DOWN:"dn",MIDDLE:"md"},gameutils.DIRECTION={UP:"u",DOWN:"d",LEFT:"l",RIGHT:"r"},gameutils.isFun=a,gameutils.scaleToFill=b,gameutils.fitV=d,gameutils.fitH=c,gameutils.anchorInCanvas=e,gameutils.anchorInParent=f,gameutils.align=i,gameutils.simpleAlign=g}();